# 第8章 加载器

在前面的章节中我们已经实现了一个简单的加载器，它会被用来加载servlet。本章会介绍标准的web应用程序加载器，简称loader。一个servlet容器需要一个自定义的加载器，不能简单地使用系统的类加载器，因为它不应该完全信任正在运行的servlet。如果使用系统的类加载器来加载所有的servlet和servlet所需的类，就像我们在前面的章节所做的那样，那么servlet就可以访问这个正在运行的JVM环境变量CLASSPATH中的所有类和类库，这是不安全的。servlet应该只允许加载WEB-INF/classes目录及其子目录以及部署到WEB-INF/lib目录的类库中的类。这就是为什么servlet容器需要有一个自己的加载器的原因。在一个servlet容器中的每个web应用（context）都有它自己的加载器。一个Loader使用一个类加载器，这个类加载器会根据特定的规则来加载类。在Catalina中，org.apache.catalina.Loader接口表示一个loader。

Tomcat需要它自己的加载器的另一个原因，是为了在WEB-INF/classes或者WEB-INF/lib目录下的类发生变化时能够自动加载。在Tomcat的载入器的类加载器的实现中，使用了独立的线程来持续检查servlet和其他类的时间戳。为了能够自动重载，类加载器必须实现org.apache.catalina.loader.Reloader接口。

本章的第一小节会简单地回顾下Java的类加载机制，然后介绍Loader接口，所有的loader都需要实现此接口，接着介绍Reloader接口。在了解了loader和类加载器的实现后，我们会用一个应用程序来展示如何使用Tomcat的loader。

本章中，有两个概念会广泛使用：仓库（repository）和资源（resources）。仓库是类加载器查找的地方，即类加载器会在仓库里面搜索需要加载的类，而资源是指类加载器中的DirContext对象，它的document base指向context的document base。